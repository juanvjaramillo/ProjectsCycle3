@page "/movies/filter"
@using BlazorProjectIII.Client.Pages.Components

@inject IServiceMovie movie

<div class="container">
    <div class="jumbotron">
        @* Campo en el cual el usuario ingresa el nombre o texto a bustcar en la lista de objetos de la interfaz o servicio *@
        <div class="form-group mb-3">
            <input type="text" @bind-Value="movie_name" @bind-Value:event="oninput" @onkeypress="@((KeyboardEventArgs e)=>MovieSearch(e))" class="form-control" id="movie_name" placeholder="Buscar película"/>
        </div>
        @* Lista desplegable con todas las categorías disponibles *@
        <div class="form-group mb-3">
            <select name="" id="" class="form-control" @bind="categorySelected">
                <option value="0">Selecciona una categoría</option>
                @foreach (var category in Categories)
                {
                    <option value="@category.Id">@category.Name</option>
                }
            </select>
        </div>

        @* opciones de categorías de conulta de películas en checkbox *@
        <div class="form-inline">
            <div class="form-group mx-sm-3 mb-3">
                <input type="checkbox" class="form-check-input" id="estrenos" @bind="futurosEstrenos">
                <label for="estrenos" class="form-check-label">Próximos estrenos</label>
            </div>

            <div class="form-group mx-sm-3 mb-3">
                <input type="checkbox" class="form-check-input" id="cartelera" @bind="enCartelera">
                <label for="cartelera" class="form-check-label">En cartelera</label>
            </div>

            <div class="form-group mx-sm-3 mb-3">
                <input type="checkbox" class="form-check-input" id="mejor_calificada" @bind="mejorCalificada">
                <label for="mejor_calificada" class="form-check-label">Mejor calificadas</label>
            </div>
        </div>

        <div>
            <button type="button" class="btn btn-primary mb-2 mx-xm-3" @onclick="ShowMovies">Buscar</button>
            <button type="button" class="btn btn-primary mb-2 mx-xm-3" @onclick="ClearInputs">Limpiar</button>
        </div>
    </div>
</div>


<ServiceMovieComponent Movies = "Movies"></ServiceMovieComponent>

@code{
    private List<Movie> Movies;
    private List<Category> Categories = new List<Category>();
    string movie_name = "";
    string categorySelected = "";
    private bool futurosEstrenos = false;
    private bool enCartelera = false;
    private bool mejorCalificada = false;

    protected override void OnInitialized(){
        Movies=movie.GetMovies();
    }

    private void ShowMovies(){
        Movies = movie.GetMovies().Where(x=>x.Name.ToLower().Contains(movie_name.ToLower())).ToList();
        Console.WriteLine($"Pelicula que ingreso el usuario a buscar: {movie_name}");
        Console.WriteLine($"Categoria seleccionada {categorySelected}");
        Console.WriteLine($"Próximos estrenos {futurosEstrenos}, en cartelera {enCartelera}, mejor calificada {mejorCalificada}");
    }

    private void ClearInputs(){
        Movies = movie.GetMovies();
        movie_name = "";
        categorySelected = "0";
        futurosEstrenos = false;
        enCartelera = false;
        mejorCalificada = false;
    }

    private void MovieSearch(KeyboardEventArgs e){
        if(e.Key == "Enter"){
            ShowMovies();
        }
    }

}